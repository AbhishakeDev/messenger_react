{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abhishektripathi/Documents/JSMastery/facebook_messenger/unichat-course/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/abhishektripathi/Documents/JSMastery/facebook_messenger/unichat-course/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/abhishektripathi/Documents/JSMastery/facebook_messenger/unichat-course/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import axios from'axios';import{useHistory}from'react-router-dom';import{ChatEngine}from'react-chat-engine';import{useAuth}from'../contexts/AuthContext';import{auth}from'../firebase';export default function Chats(){var didMountRef=useRef(false);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var history=useHistory();function handleLogout(){return _handleLogout.apply(this,arguments);}function _handleLogout(){_handleLogout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push('/');case 3:case\"end\":return _context.stop();}}},_callee);}));return _handleLogout.apply(this,arguments);}function getFile(_x){return _getFile.apply(this,arguments);}function _getFile(){_getFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(url);case 2:response=_context2.sent;_context2.next=5;return response.blob();case 5:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],'test.jpg',{type:'image/jpeg'}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _getFile.apply(this,arguments);}useEffect(function(){if(!didMountRef.current){didMountRef.current=true;if(!user||user===null){history.push('/');return;}axios.get('https://api.chatengine.io/users/me/',{headers:{'project-id':process.env.REACT_APP_CHAT_ENGINE_ID,'user-name':user.email,'user-secret':user.uid}}).then(function(){return setLoading(false);}).catch(function(e){var formdata=new FormData();formdata.append('email',user.email);formdata.append('username',user.email);formdata.append('secret',user.uid);getFile(user.photoURL).then(function(avatar){formdata.append('avatar',avatar,avatar.name);axios.post('https://api.chatengine.io/users/',formdata,{headers:{'private-key':process.env.REACT_APP_CHAT_ENGINE_KEY}}).then(function(){return setLoading(false);}).catch(function(e){return console.log('e',e.response);});});});}},[user,history]);if(!user||loading)return/*#__PURE__*/React.createElement(\"div\",null);return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},\"Unichat\"),/*#__PURE__*/React.createElement(\"div\",{onClick:handleLogout,className:\"logout-tab\"},\"Logout\")),/*#__PURE__*/React.createElement(ChatEngine,{height:\"calc(100vh - 66px)\",projectID:process.env.REACT_APP_CHAT_ENGINE_ID,userName:user.email,userSecret:user.uid}));}","map":{"version":3,"sources":["/Users/abhishektripathi/Documents/JSMastery/facebook_messenger/unichat-course/src/components/Chats.js"],"names":["React","useRef","useState","useEffect","axios","useHistory","ChatEngine","useAuth","auth","Chats","didMountRef","loading","setLoading","user","history","handleLogout","signOut","push","getFile","url","fetch","response","blob","data","File","type","current","get","headers","process","env","REACT_APP_CHAT_ENGINE_ID","email","uid","then","catch","e","formdata","FormData","append","photoURL","avatar","name","post","REACT_APP_CHAT_ENGINE_KEY","console","log"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\n\nimport axios from 'axios';\nimport { useHistory } from 'react-router-dom';\nimport { ChatEngine } from 'react-chat-engine';\n\nimport { useAuth } from '../contexts/AuthContext';\n\nimport { auth } from '../firebase';\n\nexport default function Chats() {\n  const didMountRef = useRef(false);\n  const [loading, setLoading] = useState(true);\n  const { user } = useAuth();\n  const history = useHistory();\n\n  async function handleLogout() {\n    await auth.signOut();\n    history.push('/');\n  }\n\n  async function getFile(url) {\n    let response = await fetch(url);\n    let data = await response.blob();\n    return new File([data], 'test.jpg', { type: 'image/jpeg' });\n  }\n\n  useEffect(() => {\n    if (!didMountRef.current) {\n      didMountRef.current = true;\n\n      if (!user || user === null) {\n        history.push('/');\n        return;\n      }\n\n      axios\n        .get('https://api.chatengine.io/users/me/', {\n          headers: {\n            'project-id': process.env.REACT_APP_CHAT_ENGINE_ID,\n            'user-name': user.email,\n            'user-secret': user.uid,\n          },\n        })\n\n        .then(() => setLoading(false))\n\n        .catch((e) => {\n          let formdata = new FormData();\n          formdata.append('email', user.email);\n          formdata.append('username', user.email);\n          formdata.append('secret', user.uid);\n\n          getFile(user.photoURL).then((avatar) => {\n            formdata.append('avatar', avatar, avatar.name);\n\n            axios\n              .post('https://api.chatengine.io/users/', formdata, {\n                headers: {\n                  'private-key': process.env.REACT_APP_CHAT_ENGINE_KEY,\n                },\n              })\n              .then(() => setLoading(false))\n              .catch((e) => console.log('e', e.response));\n          });\n        });\n    }\n  }, [user, history]);\n\n  if (!user || loading) return <div />;\n\n  return (\n    <div className='chats-page'>\n      <div className='nav-bar'>\n        <div className='logo-tab'>Unichat</div>\n\n        <div onClick={handleLogout} className='logout-tab'>\n          Logout\n        </div>\n      </div>\n\n      <ChatEngine\n        height='calc(100vh - 66px)'\n        projectID={process.env.REACT_APP_CHAT_ENGINE_ID}\n        userName={user.email}\n        userSecret={user.uid}\n      />\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}